let express = require('express');
let singleStockService = require('../bl/singleStockbl');
let router = express.Router();

let daily_rawData = [
    ['2017-03-29',
        9.13,
        9.11,
        9.09,
        9.15,
        -0.11,
        60114000,
        0.36,
        11.488811791795413,
        16.208770670265437,
        25.648688427205485,
        -0.06920844446638519,
        -0.03601808254391087,
        -0.06638072384494864,
        9.11,
        19.047619047619047,
        21.052631578947363,
        29.591836734693878],
    ['2017-03-30',
        9.12,
        9.08,
        9.06,
        9.12,
        -0.33,
        68728500,
        0.41,
        10.32587452786355,
        14.247805289464807,
        22.09166681266732,
        -0.0759072009240036,
        -0.043995906219929416,
        -0.06382258940814838,
        9.08,
        25,
        19.999999999999996,
        28.999999999999996],
    ['2017-03-31',
        9.08,
        9.17,
        9.08,
        9.18,
        0.99,
        63312100,
        0.37,
        25.217249685242336,
        17.904286754723984,
        3.278360893687278,
        -0.07510528987599585,
        -0.0502177829511427,
        -0.0497750138497063,
        9.17,
        42.85714285714285,
        26.15384615384615,
        37.25490196078431],
    ['2017-04-05',
        9.16,
        9.21,
        9.15,
        9.22,
        0.44,
        49915000,
        0.29,
        44.58927756793944,
        26.799283692462467,
        -8.78070405849148,
        -0.06983193746087935,
        -0.05414061385309003,
        -0.031382647215578624,
        9.21,
        54.166666666666664,
        26.15384615384615,
        36.63366336633663],
    ['2017-04-06',
        9.2,
        9.2,
        9.17,
        9.22,
        -0.11,
        43439100,
        0.26,
        55.652110971218704,
        36.41689278538121,
        -2.0535435862937845,
        -0.06490458799079057,
        -0.056293408680630146,
        -0.017222358620320857,
        9.2,
        65,
        37.77777777777778,
        35.64356435643564],
    ['2017-04-07',
        9.19,
        9.2,
        9.17,
        9.22,
        0,
        51484400,
        0.3,
        63.02733324007154,
        45.28703960361132,
        9.80645233069086,
        -0.06030447557985852,
        -0.057095622060475824,
        -0.006417707038765388,
        9.2,
        72.22222222222223,
        43.58974358974359,
        37.89473684210526],
    ['2017-04-10',
        9.2,
        9.18,
        9.17,
        9.21,
        -0.22,
        40134300,
        0.24,
        67.01822216004751,
        52.530767122423384,
        23.555857047175124,
        -0.057010319410839116,
        -0.05707856153054849,
        0.000136484239418741,
        9.18,
        68.42105263157895,
        42.49999999999999,
        38.297872340425535],
    ['2017-04-11',
        9.17,
        9.15,
        9.09,
        9.19,
        -0.33,
        61243700,
        0.36,
        63.42881477336496,
        56.163449672737244,
        41.632719471481806,
        -0.05697062076661297,
        -0.05705697337776139,
        0.00017270522229684282,
        9.15,
        68.42105263157895,
        48.57142857142858,
        33.69565217391304],
    ['2017-04-12',
        9.16,
        9.12,
        9.1,
        9.17,
        -0.33,
        45533600,
        0.27,
        54.78587651557636,
        55.70425862035028,
        57.54102282989811,
        -0.05768629139273962,
        -0.05718283698075704,
        -0.0010069088239651608,
        9.12,
        30.76923076923077,
        38.235294117647065,
        32.63157894736842],
    ['2017-04-13',
        9.11,
        9.12,
        9.1,
        9.14,
        0,
        35744200,
        0.21,
        49.023917677050626,
        53.47747830591706,
        62.38459956364993,
        -0.058187898961442386,
        -0.057383849376894114,
        -0.001608099169096544,
        9.12,
        0,
        39.3939393939394,
        33.69565217391304],
    ['2017-04-14',
        9.11,
        9.08,
        9.06,
        9.12,
        -0.44,
        49050000,
        0.29,
        36.849278451366985,
        47.93474502106703,
        70.10567816046711,
        -0.0607098091766769,
        -0.05804904133685067,
        -0.0053215356796524615,
        9.08,
        0,
        40.625,
        33.69565217391303],
    ['2017-04-17',
        9.08,
        9.1,
        9.05,
        9.11,
        0.22,
        53189200,
        0.31,
        34.3701072028719,
        43.41319908166865,
        61.49938283926214,
        -0.061594954682325564,
        -0.05875822400594565,
        -0.005673461352759826,
        9.1,
        14.285714285714285,
        46.875,
        33.69565217391303],
    ['2017-04-18',
        9.09,
        9.05,
        9.05,
        9.1,
        -0.55,
        33537600,
        0.2,
        22.9134048019146,
        36.579934321750635,
        63.9129933614227,
        -0.06378024013908856,
        -0.059762627232574236,
        -0.008035225813028651,
        9.05,
        11.76470588235294,
        41.666666666666664,
        29.03225806451612],
    ['2017-04-19',
        9.03,
        8.91,
        8.9,
        9.04,
        -1.55,
        79966800,
        0.47,
        16.317269867943043,
        29.825712837148103,
        56.84259877555822,
        -0.0745375978030598,
        -0.06271762134667136,
        -0.023639952912776874,
        8.91,
        7.142857142857142,
        31.914893617021274,
        25.233644859813076],
    ['2017-04-20',
        8.9,
        8.92,
        8.89,
        8.94,
        0.11,
        43763000,
        0.26,
        14.00317991196196,
        24.55153519541939,
        45.648245762334255,
        -0.08391116750784633,
        -0.06695633057890635,
        -0.03390967385787996,
        8.92,
        11.538461538461538,
        17.948717948717945,
        23.07692307692307],
    ['2017-04-21',
        8.92,
        8.97,
        8.9,
        8.99,
        0.56,
        32540800,
        0.19,
        18.22434216353023,
        22.442470851456335,
        30.878728227308542,
        -0.08710799656421209,
        -0.0709866637759675,
        -0.032242665576489166,
        8.97,
        25.806451612903224,
        20,
        23.809523809523803],
    ['2017-04-24',
        8.97,
        8.93,
        8.89,
        8.98,
        -0.45,
        39499500,
        0.23,
        16.911466204258158,
        20.598802635723608,
        27.97347549865451,
        -0.09061425298656012,
        -0.07491218161808604,
        -0.031404142736948165,
        8.93,
        25.806451612903224,
        18.6046511627907,
        28.4090909090909],
    ['2017-04-25',
        8.93,
        9,
        8.93,
        9.01,
        0.78,
        37793300,
        0.22,
        25.940977469505363,
        22.379527580317525,
        15.256627801941846,
        -0.08814064473641636,
        -0.0775578742417521,
        -0.02116554098932852,
        9,
        36.11111111111111,
        30.00000000000001,
        35.95505617977528],
    ['2017-04-26',
        9,
        8.99,
        8.96,
        9.01,
        -0.11,
        38214700,
        0.23,
        31.78673860285868,
        25.515264587831243,
        12.972316557776374,
        -0.08499875058332407,
        -0.0790460495100665,
        -0.011905402146515143,
        8.99,
        40.625,
        30.612244897959183,
        35.95505617977528],
    ['2017-04-27',
        8.97,
        8.97,
        8.91,
        8.98,
        -0.22,
        38739200,
        0.23,
        33.31237118978464,
        28.11430012181571,
        17.718157985877838,
        -0.08396166826300089,
        -0.08002917326065337,
        -0.007864990004695038,
        8.97,
        65,
        31.250000000000007,
        38.55421686746988],
    ['2017-04-28',
        8.96,
        8.99,
        8.92,
        8.99,
        0.22,
        28644600,
        0.17,
        38.08126333287231,
        31.436621192167905,
        18.147336910759094,
        -0.08099573005462268,
        -0.08022248461944724,
        -0.0015464908703508862,
        8.99,
        66.66666666666666,
        36.17021276595745,
        37.03703703703704]];

function splitData(daily_rawData) {
    let categoryData = [];
    let values = [];
    let changeRates = [];
    let volumns = [];
    let turnOverRates = [];
    let kIndexes = [];
    let dIndexes = [];
    let jIndexes = [];
    let difs = [];
    let deas = [];
    let macds = [];
    let adjs = [];
    let rsi6s = [];
    let rsi12s = [];
    let rsi24s = [];
    for (let i = 0; i < daily_rawData.length; i++) {
        categoryData.push(daily_rawData[i].splice(0, 1)[0]);
        values.push(daily_rawData[i].splice(0, 4));
        changeRates.push(daily_rawData[i].splice(0, 1)[0]);
        volumns.push(daily_rawData[i].splice(0, 1)[0]);
        kIndexes.push(daily_rawData[i].splice(0, 1)[0]);
        dIndexes.push(daily_rawData[i].splice(0, 1)[0]);
        jIndexes.push(daily_rawData[i].splice(0, 1)[0]);
        turnOverRates.push(daily_rawData[i].splice(0, 1)[0]);
        difs.push(daily_rawData[i].splice(0, 1)[0]);
        deas.push(daily_rawData[i].splice(0, 1)[0]);
        macds.push(daily_rawData[i].splice(0, 1)[0]);
        adjs.push(daily_rawData[i].splice(0, 1)[0]);
        rsi6s.push(daily_rawData[i].splice(0, 1)[0]);
        rsi12s.push(daily_rawData[i].splice(0, 1)[0]);
        rsi24s.push(daily_rawData[i].splice(0, 1)[0]);
    }
    return {
        categoryData: categoryData,
        KLineValue: values,
        changeRates: changeRates,
        volumns: volumns,
        turnOverRates: turnOverRates,
        kIndexes: kIndexes,
        dIndexes: dIndexes,
        jIndexes: jIndexes,
        difs: difs,
        deas: deas,
        macds: macds,
        adjs: adjs,
        rsi6s: rsi6s,
        rsi12s: rsi12s,
        rsi24s: rsi24s
    };
}

/* GET users listing. */
router.post('/search', function(req, res, next) {
    console.log('THIS WORKS!');

    let re = /(.*)\(([0-9]+)\)/;
    let result = re.exec(req.body.query);
    let stockCode = result[1];

    console.log(stockCode);
    // singleStockService.getDailyData(stockCode, (err, docs) => {
    //     if(err)
    //         render('error');

        let daily_data = splitData(daily_rawData);
        res.send(daily_data);
    // });
});

router.post('/ajax/getSearchResult', function(req, res, next) {

});

module.exports = router;